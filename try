<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مشغل فيديو مع Timeline متقدم</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #1a1a1a;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .video-player {
            width: 100%;
            max-width: 1000px;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        #video {
            width: 100%;
            display: block;
        }

        /* Timeline Container المتقدم */
        .timeline-container {
            padding: 20px;
            background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
            border-top: 1px solid #404040;
        }

        /* شريط Timeline الرئيسي */
        .timeline {
            position: relative;
            height: 8px;
            background: #404040;
            border-radius: 4px;
            cursor: pointer;
            margin: 15px 0;
            transition: height 0.2s ease;
        }

        .timeline:hover {
            height: 12px;
        }

        /* شريط التقدم */
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            border-radius: 4px;
            width: 0%;
            transition: width 0.1s linear;
            position: relative;
        }

        /* نقطة التحكم (Scrubber) */
        .scrubber {
            position: absolute;
            top: 50%;
            right: -8px;
            width: 16px;
            height: 16px;
            background: #fff;
            border-radius: 50%;
            transform: translateY(-50%);
            cursor: grab;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        .scrubber:active {
            cursor: grabbing;
            transform: translateY(-50%) scale(1.2);
        }

        /* مؤشر الوقت المتحرك */
        .time-tooltip {
            position: absolute;
            top: -40px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            white-space: nowrap;
        }

        .timeline:hover .time-tooltip {
            opacity: 1;
        }

        /* معاينة الفيديو عند التحويم */
        .preview-container {
            position: absolute;
            top: -120px;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            z-index: 10;
        }

        .timeline:hover .preview-container {
            opacity: 1;
        }

        .video-preview {
            width: 160px;
            height: 90px;
            background: #000;
            border-radius: 6px;
            border: 2px solid #fff;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        /* نقاط المحتوى المهمة (Chapters) */
        .chapter-markers {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .chapter-marker {
            position: absolute;
            top: 50%;
            width: 3px;
            height: 16px;
            background: #ffeb3b;
            transform: translateY(-50%);
            border-radius: 2px;
            cursor: pointer;
            pointer-events: all;
        }

        .chapter-marker:hover {
            background: #ffc107;
            height: 20px;
        }

        /* أزرار التحكم */
        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .control-btn {
            background: transparent;
            border: none;
            color: #fff;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .play-pause {
            font-size: 24px;
        }

        .time-display {
            color: #ccc;
            font-size: 14px;
            min-width: 100px;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .volume-slider {
            width: 80px;
            height: 4px;
            background: #404040;
            border-radius: 2px;
            outline: none;
            cursor: pointer;
        }

        /* شريط التقدم الثانوي (Buffer) */
        .buffer {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: #666;
            border-radius: 4px;
            width: 0%;
        }

        /* Speed Control */
        .speed-control {
            color: #fff;
            background: transparent;
            border: 1px solid #666;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Timeline المصغر للفيديوهات الطويلة */
        .mini-timeline {
            position: absolute;
            bottom: 80px;
            left: 20px;
            right: 20px;
            height: 3px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .video-player:hover .mini-timeline {
            opacity: 1;
        }

        .mini-progress {
            height: 100%;
            background: #fff;
            border-radius: 2px;
            width: 0%;
        }

    </style>
</head>
<body>

    <div class="video-player">
        <video id="https://archive.org/download/20250916_20250916_0112/%D9%84%D8%BA%D8%A9_%D8%A7%D9%84%D8%A3%D8%B9%D9%85%D8%A7%D9%84__%D9%85%D9%82%D8%AF%D9%85%D8%A9_%D9%84%D9%84%D9%85%D8%AD%D8%A7%D8%B3%D8%A8%D8%A9.mp4"></video>

        <!-- Timeline مصغر -->
        <div class="mini-timeline">
            <div class="mini-progress" id="miniProgress"></div>
        </div>

        <div class="timeline-container">
            <!-- Timeline الرئيسي المتقدم -->
            <div class="timeline" id="timeline">
                <!-- شريط Buffer -->
                <div class="buffer" id="buffer"></div>
                
                <!-- شريط التقدم -->
                <div class="progress" id="progress">
                    <div class="scrubber" id="scrubber"></div>
                </div>

                <!-- نقاط المحتوى -->
                <div class="chapter-markers" id="chapterMarkers">
                    <!-- سيتم إضافة النقاط هنا بـ JavaScript -->
                </div>

                <!-- معاينة الفيديو -->
                <div class="preview-container" id="previewContainer">
                    <canvas class="video-preview" id="previewCanvas" width="160" height="90"></canvas>
                    <div class="time-tooltip" id="timeTooltip">00:00</div>
                </div>
            </div>

            <!-- أزرار التحكم -->
            <div class="controls">
                <button class="control-btn play-pause" id="playPause">▶</button>
                
                <div class="time-display" id="timeDisplay">
                    <span id="currentTime">00:00</span> / <span id="duration">00:00</span>
                </div>

                <div class="volume-container">
                    <button class="control-btn" id="muteBtn">🔊</button>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="100">
                </div>

                <select class="speed-control" id="speedControl">
                    <option value="0.5">0.5x</option>
                    <option value="0.75">0.75x</option>
                    <option value="1" selected>1x</option>
                    <option value="1.25">1.25x</option>
                    <option value="1.5">1.5x</option>
                    <option value="2">2x</option>
                </select>

                <button class="control-btn" id="fullscreenBtn">⛶</button>
            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('video');
        const timeline = document.getElementById('timeline');
        const progress = document.getElementById('progress');
        const scrubber = document.getElementById('scrubber');
        const playPause = document.getElementById('playPause');
        const timeDisplay = document.getElementById('timeDisplay');
        const currentTime = document.getElementById('currentTime');
        const duration = document.getElementById('duration');
        const previewContainer = document.getElementById('previewContainer');
        const previewCanvas = document.getElementById('previewCanvas');
        const timeTooltip = document.getElementById('timeTooltip');
        const chapterMarkers = document.getElementById('chapterMarkers');
        const miniProgress = document.getElementById('miniProgress');
        const buffer = document.getElementById('buffer');
        const volumeSlider = document.getElementById('volumeSlider');
        const muteBtn = document.getElementById('muteBtn');
        const speedControl = document.getElementById('speedControl');
        const fullscreenBtn = document.getElementById('fullscreenBtn');

        let isDragging = false;

        // نقاط المحتوى المهمة (يمكنك تعديلها حسب محتوى الفيديو)
        const chapters = [
            { time: 30, title: "المقدمة" },
            { time: 120, title: "التعريفات" },
            { time: 300, title: "الأمثلة العملية" },
            { time: 480, title: "الخلاصة" }
        ];

        // إضافة نقاط المحتوى
        function addChapterMarkers() {
            chapters.forEach(chapter => {
                const marker = document.createElement('div');
                marker.className = 'chapter-marker';
                marker.style.left = '0%';
                marker.title = chapter.title;
                marker.addEventListener('click', () => {
                    video.currentTime = chapter.time;
                });
                chapterMarkers.appendChild(marker);
            });
        }

        // تحديث موقع نقاط المحتوى
        function updateChapterMarkers() {
            const markers = chapterMarkers.querySelectorAll('.chapter-marker');
            markers.forEach((marker, index) => {
                const percentage = (chapters[index].time / video.duration) * 100;
                marker.style.left = percentage + '%';
            });
        }

        // تشغيل/إيقاف
        playPause.addEventListener('click', () => {
            if (video.paused) {
                video.play();
                playPause.textContent = '⏸';
            } else {
                video.pause();
                playPause.textContent = '▶';
            }
        });

        // تحديث Timeline
        video.addEventListener('timeupdate', () => {
            if (!isDragging) {
                const percentage = (video.currentTime / video.duration) * 100;
                progress.style.width = percentage + '%';
                miniProgress.style.width = percentage + '%';
            }
            
            currentTime.textContent = formatTime(video.currentTime);
            
            // تحديث شريط Buffer
            if (video.buffered.length > 0) {
                const bufferedEnd = video.buffered.end(video.buffered.length - 1);
                const bufferedPercentage = (bufferedEnd / video.duration) * 100;
                buffer.style.width = bufferedPercentage + '%';
            }
        });

        // عند تحميل metadata
        video.addEventListener('loadedmetadata', () => {
            duration.textContent = formatTime(video.duration);
            addChapterMarkers();
            updateChapterMarkers();
        });

        // التحكم في Timeline بالسحب
        let timelineRect;
        
        timeline.addEventListener('mousedown', startDragging);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', stopDragging);

        function startDragging(e) {
            isDragging = true;
            timelineRect = timeline.getBoundingClientRect();
            updateVideoTime(e);
        }

        function drag(e) {
            if (isDragging) {
                updateVideoTime(e);
            }
        }

        function stopDragging() {
            isDragging = false;
        }

        function updateVideoTime(e) {
            const clickX = e.clientX - timelineRect.left;
            const percentage = Math.max(0, Math.min(100, (clickX / timelineRect.width) * 100));
            const newTime = (percentage / 100) * video.duration;
            
            video.currentTime = newTime;
            progress.style.width = percentage + '%';
        }

        // معاينة عند التحويم
        timeline.addEventListener('mousemove', (e) => {
            if (!isDragging) {
                const rect = timeline.getBoundingClientRect();
                const percentage = (e.clientX - rect.left) / rect.width;
                const time = percentage * video.duration;
                
                timeTooltip.textContent = formatTime(time);
                timeTooltip.style.left = (e.clientX - rect.left) + 'px';
                previewContainer.style.left = (e.clientX - rect.left) + 'px';
                
                // رسم معاينة الفيديو (مبسط)
                drawPreview(time);
            }
        });

        // رسم معاينة مبسطة
        function drawPreview(time) {
            const ctx = previewCanvas.getContext('2d');
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, 160, 90);
            ctx.fillStyle = '#fff';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(formatTime(time), 80, 50);
        }

        // تحكم في مستوى الصوت
        volumeSlider.addEventListener('input', () => {
            video.volume = volumeSlider.value / 100;
        });

        muteBtn.addEventListener('click', () => {
            video.muted = !video.muted;
            muteBtn.textContent = video.muted ? '🔇' : '🔊';
        });

        // تحكم في السرعة
        speedControl.addEventListener('change', () => {
            video.playbackRate = parseFloat(speedControl.value);
        });

        // شاشة كاملة
        fullscreenBtn.addEventListener('click', () => {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                video.parentElement.requestFullscreen();
            }
        });

        // تنسيق الوقت
        function formatTime(seconds) {
            if (isNaN(seconds)) return '00:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // اختصارات لوحة المفاتيح
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName !== 'INPUT') {
                switch(e.key) {
                    case ' ':
                        e.preventDefault();
                        playPause.click();
                        break;
                    case 'ArrowRight':
                        video.currentTime += 10;
                        break;
                    case 'ArrowLeft':
                        video.currentTime -= 10;
                        break;
                    case 'ArrowUp':
                        video.volume = Math.min(1, video.volume + 0.1);
                        volumeSlider.value = video.volume * 100;
                        break;
                    case 'ArrowDown':
                        video.volume = Math.max(0, video.volume - 0.1);
                        volumeSlider.value = video.volume * 100;
                        break;
                }
            }
        });

    </script>

</body>
</html>
